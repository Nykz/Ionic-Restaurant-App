import{a as U}from"./chunk-TJCMDKVC.js";import{a as J}from"./chunk-LRS7MZID.js";import{a as A}from"./chunk-3CU4KGJ6.js";import"./chunk-L5LJPID7.js";import"./chunk-UDTTHNTT.js";import{a as z}from"./chunk-6M254L2Q.js";import"./chunk-SG7NFAYP.js";import{a as K}from"./chunk-UX7P3H4G.js";import{a as W,c as $,e as H}from"./chunk-3XMFGL7I.js";import"./chunk-BRGWQJYK.js";import"./chunk-E27WRCEQ.js";import{b as G}from"./chunk-FL3AVRJI.js";import{A as u,B as r,Bb as q,Cb as k,Eb as j,J as a,K as l,L as O,Nb as B,O as f,P as _,Q as c,S as R,T as D,U as P,W as C,Zb as Q,ab as L,da as T,jb as M,ma as x,n as d,na as I,o as g,pb as E,t as h,u as w,wb as F,x as V,xb as N}from"./chunk-36II4WRS.js";import"./chunk-HTSKCE6I.js";import"./chunk-7KGURMOZ.js";import"./chunk-G2NBWZGV.js";import"./chunk-5ZMMP3RU.js";import"./chunk-NOFUNQAN.js";import"./chunk-TIZDWYJD.js";import"./chunk-GF5ML23A.js";import"./chunk-G3CV3VGG.js";import"./chunk-JX3TYZ34.js";import"./chunk-RUY5SX76.js";import"./chunk-NIOQNOHM.js";import"./chunk-4U6PRYVA.js";import"./chunk-BE36LD5W.js";import"./chunk-JWIEPCRG.js";import"./chunk-QPVVTFFW.js";import"./chunk-J6ICYO4L.js";import"./chunk-LF5XB4YN.js";import{a as v,b as y,f as m}from"./chunk-RW4GY4BD.js";var X=["cancel_modal"],Y=()=>[.5,.7,.9];function Z(n,o){n&1&&O(0,"app-loading-order")}function ee(n,o){if(n&1&&O(0,"app-empty-screen",10),n&2){let s=c();r("model",s.segmentValue=="1"?s.model:s.model1)}}function te(n,o){if(n&1){let s=f();a(0,"app-orders",12),_("status",function(t){d(s);let i=c(2);return g(i.changeOrderStatus(t))}),l()}if(n&2){let s=o.$implicit;r("order",s)}}function ie(n,o){if(n&1&&(a(0,"ion-list"),u(1,te,1,1,"app-orders",11),l()),n&2){let s=c();h(),r("ngForOf",s.newOrders)}}function ne(n,o){if(n&1){let s=f();a(0,"app-orders",14),_("callRider",function(t){d(s);let i=c(2);return g(i.call(t))})("requestRider",function(t){d(s);let i=c(2);return g(i.requestRider(t))})("status",function(t){d(s);let i=c(2);return g(i.changeOrderStatus(t))}),l()}if(n&2){let s=o.$implicit;r("order",s)}}function se(n,o){if(n&1&&(a(0,"ion-list"),u(1,ne,1,1,"app-orders",13),l()),n&2){let s=c();h(),r("ngForOf",s.ongoingOrders)}}function oe(n,o){if(n&1){let s=f();a(0,"app-cancel-reason",15),_("close",function(t){d(s);let i=c();return g(i.closeCancelModal(t))}),l()}if(n&2){let s=c();r("title",(s.cancelModel==null?null:s.cancelModel.status)=="Rejected"?"Rejection Reason":"Cancel Reason")}}var fe=(()=>{let o=class o{constructor(e,t){this.global=e,this.orderService=t,this.openCancel=!1,this.cancelModel={},this.segmentValue="1",this.newOrders=[],this.ongoingOrders=[],this.isLoading=!1,this.model={icon:"fast-food-outline",title:"No New Orders"},this.model1={icon:"fast-food-outline",title:"No Ongoing Orders"},this.hasFetched={segment1:!1,segment2:!1},W({callOutline:H,arrowBackOutline:$})}ngOnInit(){this.fetchData(this.segmentValue),this.newOrdersSub=this.orderService.newOrders.subscribe({next:e=>{this.newOrders=e,console.log("new orders: ",this.newOrders)}}),this.ongoingOrdersSub=this.orderService.ongoingOrders.subscribe({next:e=>{this.ongoingOrders=e}})}segmentChanged(e){console.log(e),this.segmentValue=e.detail.value,this.hasFetched[this.segmentValue]||this.fetchData(this.segmentValue)}fetchData(e){this.hasFetched[e]=!0,setTimeout(()=>{e=="1"?this.getNewOrders():this.getOngoingOrders()},1e3)}resetSegmentCache(e,t=!1){this.hasFetched[e]=!1,t&&(this.segmentValue=="1"?this.orderService.resetNewOrders():this.orderService.resetOngoingOrders())}getNewOrders(){return m(this,null,function*(){this.isLoading=!0;try{console.log("getorders"),yield this.orderService.getNewOrders(),this.isLoading=!1}catch(e){console.log(e),this.isLoading=!1,this.global.errorToast()}})}getOngoingOrders(){return m(this,null,function*(){this.isLoading=!0;try{console.log("getorders"),yield this.orderService.getOngoingOrders(),this.isLoading=!1}catch(e){console.log(e),this.isLoading=!1,this.global.errorToast()}})}handleRefresh(e){setTimeout(()=>{this.resetSegmentCache(this.segmentValue,!0),this.fetchData(this.segmentValue),e.target.complete()},1500)}closeCancelModal(e){if(console.log("data: ",e),e){let t=y(v({},this.cancelModel),{cancel_reason:e});this.changeStatus(t)}this.cancelModel={},this.modal.dismiss()}changeOrderStatus(e){(e==null?void 0:e.status)=="Cancelled"||(e==null?void 0:e.status)=="Rejected"?(this.openCancel=!0,this.cancelModel=e):this.changeStatus(e)}changeStatus(e){return m(this,null,function*(){try{this.global.showLoader(),console.log(e);let t=yield this.orderService.changeOrderStatus(e);console.log("status change result: ",t),((e==null?void 0:e.status)=="Cancelled"||(e==null?void 0:e.status)=="Rejected")&&e!=null&&e.payment_status&&(yield this.orderService.updateCustomerWallet(e)),this.global.hideLoader()}catch(t){console.log(t),this.global.hideLoader(),this.global.errorToast()}})}call(e){this.global.call(e).then(()=>{}).catch(t=>console.log(t))}requestRider(e){return m(this,null,function*(){try{this.global.showLoader(),yield this.orderService.requestRider(e),this.global.hideLoader()}catch{this.global.hideLoader(),this.global.errorToast()}})}ngOnDestroy(){console.log("ondestroy dashboardpage"),this.newOrdersSub&&this.newOrdersSub.unsubscribe(),this.ongoingOrdersSub&&this.ongoingOrdersSub.unsubscribe(),this.orderService.resetDashboard()}};o.\u0275fac=function(t){return new(t||o)(w(G),w(z))},o.\u0275cmp=V({type:o,selectors:[["app-dashboard"]],viewQuery:function(t,i){if(t&1&&R(X,5),t&2){let p;D(p=P())&&(i.modal=p.first)}},decls:20,vars:9,consts:[["cancel_modal",""],["align","center",3,"ionChange"],[3,"value"],["value","1"],["value","2"],[1,"ion-padding"],["slot","fixed",3,"ionRefresh"],[4,"ngIf"],[3,"model",4,"ngIf"],[3,"didDismiss","isOpen","breakpoints","initialBreakpoint"],[3,"model"],[3,"order","status",4,"ngFor","ngForOf"],[3,"status","order"],[3,"order","callRider","requestRider","status",4,"ngFor","ngForOf"],[3,"callRider","requestRider","status","order"],[3,"close","title"]],template:function(t,i){if(t&1){let p=f();a(0,"ion-header")(1,"ion-toolbar")(2,"div",1),_("ionChange",function(b){return d(p),g(i.segmentChanged(b))}),a(3,"ion-segment",2)(4,"ion-segment-button",3)(5,"ion-label"),C(6,"NEW ORDERS"),l()(),a(7,"ion-segment-button",4)(8,"ion-label"),C(9,"ONGOING ORDERS"),l()()()()()(),a(10,"ion-content",5)(11,"ion-refresher",6),_("ionRefresh",function(b){return d(p),g(i.handleRefresh(b))}),O(12,"ion-refresher-content"),l(),u(13,Z,1,0,"app-loading-order",7)(14,ee,1,1,"app-empty-screen",8)(15,ie,2,1,"ion-list",7)(16,se,2,1,"ion-list",7),a(17,"ion-modal",9,0),_("didDismiss",function(){return d(p),g(i.openCancel=!1)}),u(19,oe,1,1,"ng-template"),l()()}t&2&&(h(3),r("value",i.segmentValue),h(10),r("ngIf",i.isLoading),h(),r("ngIf",!i.isLoading&&(i.segmentValue=="1"&&(i.newOrders==null?null:i.newOrders.length)==0||i.segmentValue=="2"&&(i.ongoingOrders==null?null:i.ongoingOrders.length)==0)),h(),r("ngIf",!i.isLoading&&i.segmentValue=="1"),h(),r("ngIf",!i.isLoading&&i.segmentValue=="2"),h(),r("isOpen",i.openCancel)("breakpoints",T(8,Y))("initialBreakpoint",.9))},dependencies:[k,q,L,E,B,Q,j,F,M,N,x,I,U,A,J,K],styles:["ion-header[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{width:100%}ion-header[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]   ion-segment[_ngcontent-%COMP%]{--background: transparent}ion-header[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]   ion-segment[_ngcontent-%COMP%]   ion-segment-button[_ngcontent-%COMP%]{--color-checked: var(--ion-color-tertiary)}"]});let n=o;return n})();export{fe as DashboardPage};
