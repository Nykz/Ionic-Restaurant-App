import{a as D}from"./chunk-SG7NFAYP.js";import{a as P,b as k}from"./chunk-BRGWQJYK.js";import{a as m,b}from"./chunk-E27WRCEQ.js";import{a as O,b as C}from"./chunk-FL3AVRJI.js";import{c as g,j as f,m as h,w}from"./chunk-36II4WRS.js";import{a as l,b as v,f as d}from"./chunk-RW4GY4BD.js";var o=[{address:{id:"1",user_id:"1",address:"Rajiv Chowk, Delhi, India",house:"1st Floor",landmark:"Connaught Place",lat:28.6318545,lng:77.2203533,title:"Home"},restaurant_id:"1",user:{email:"nykz786@gmail.com",phone:"9101000000",name:"Nikhil Agarwal",id:"1",type:"user",status:"active"},order:[{category_id:"1",cover:"assets/dishes/nan.jpg",desc:"Soft and buttery Naan served with delectable paneer curry.",id:"4",name:"Butter Naan with Paneer",price:200,rating:0,status:!0,restaurant_id:"1",variation:!1,veg:!0,quantity:1},{category_id:"2",cover:"assets/dishes/pasta.jpg",desc:"Indulge in the rich and creamy Creamy Alfredo Pasta, a classic Italian favorite.",id:"5",name:"Creamy Alfredo Pasta",price:250,rating:0,status:!0,restaurant_id:"1",variation:!1,veg:!1,quantity:1}],total:450,grandTotal:470,deliveryCharge:20,status:"Delivered",rating:{rate_restaurant:4,comment_restaurant:"Taste is fine, but not like usual",rate_rider:5,comment_rider:"Delivery is fast"},payment_status:!0,payment_mode:"COD",discount:0,id:"4",user_id:"1",instruction:"Less spicy",created_at:"Jul 28, 2023 2:50 PM",updated_at:"Jul 28, 2023 2:50 PM",restaurant:{id:"1",cover:"assets/restaurants/1.jpg",name:"Stayfit Kitchen",cuisines:["Indian","Italian","Mexican"],rating:5,delivery_time:25,distance:2.5,price:100,latitude:28.633255,longitude:77.219487,address:"M-Block, Connaught Place, New Delhi, India",user_id:"6",city_id:"1"},payment_id:"1",rider:new m("abc@gmail.com","9101000003","Ravi S","4","rider","active",null,"DL05DL4321",28.633255,77.219487,"active"),rider_id:"4",restaurant_share:405,restaurant_payout_status:!0},{address:{id:"3",user_id:"1",address:"Rajiv Chowk, Delhi, India",house:"1st Floor",landmark:"Connaught Place",lat:28.6318545,lng:77.2203533,title:"Home"},restaurant_id:"5",user:{email:"nykz786@gmail.com",phone:"9101000000",name:"Nikhil Agarwal",id:"1",type:"user",status:"active"},order:[{category_id:"15",cover:"assets/dishes/margherita.jpg",desc:"Classic Margherita Pizza with fresh tomatoes, mozzarella, and basil.",id:"17",name:"Margherita Pizza",price:200,rating:0,status:!0,restaurant_id:"5",variation:!1,veg:!0,quantity:1},{category_id:"15",cover:"assets/dishes/pepperoni.jpg",desc:"Savory Pepperoni Pizza topped with delicious pepperoni slices and cheese.",id:"18",name:"Pepperoni Pizza",price:250,rating:0,status:!0,restaurant_id:"5",variation:!1,veg:!1,quantity:1},{category_id:"16",cover:"assets/dishes/bbq-chicken.png",desc:"Delicious BBQ Chicken Pizza with tender chicken and tangy barbecue sauce.",id:"21",name:"BBQ Chicken Pizza",price:260,rating:0,status:!0,restaurant_id:"5",variation:!1,veg:!1,quantity:2}],total:970,grandTotal:990,deliveryCharge:20,status:"Delivered",payment_status:!0,payment_mode:"COD",discount:0,id:"3",user_id:"1",instruction:"",created_at:"Jul 27, 2023 8:53 PM",updated_at:"Jul 27, 2023 8:53 PM",restaurant:{id:"5",cover:"assets/restaurants/pizza.jpg",name:"Pizza Hub",cuisines:["Italian","Indian","Spanish"],rating:4.6,delivery_time:20,distance:1.8,price:150,latitude:28.653237,longitude:77.237436,address:"Lal Qila, Chandni Chowk, Delhi, 110006"},payment_id:"",rating:{rate_restaurant:4,comment_restaurant:"Nice food!",rate_rider:5,comment_rider:"Delivery was quick...before time."},rider:new m("xyz@gmail.com","9101000004","Xavier","5","rider","active",null,"DL05DL3322",28.633255,77.219487,"active"),rider_id:"5"},{address:{id:"2",user_id:"1",address:"Rajiv Chowk, Delhi, India",house:"1st Floor",landmark:"Connaught Place",lat:28.6318545,lng:77.2203533,title:"Home"},restaurant_id:"4",user:{email:"nykz786@gmail.com",phone:"9101000000",name:"Nikhil Agarwal",id:"1",type:"user",status:"active"},order:[{category_id:"12",cover:"assets/dishes/chocolate_cake.png",desc:"Rich and creamy Chocolate Cake, a delightful treat for all chocolate lovers.",id:"14",name:"Chocolate Cake",price:350,rating:0,status:!0,restaurant_id:"4",variation:!1,veg:!0,quantity:1},{category_id:"12",cover:"assets/dishes/icecream_bowl.png",desc:"Assorted ice cream flavors - vanilla, chocolate, and strawberry.",id:"15",name:"Ice Cream Bowl",price:120,rating:0,status:!0,restaurant_id:"4",variation:!1,veg:!0,quantity:6}],total:1070,grandTotal:1090,deliveryCharge:20,status:"Picked",payment_status:!0,payment_mode:"COD",discount:0,id:"2",user_id:"1",instruction:"",created_at:"Jul 27, 2023 8:41 PM",updated_at:"Jul 27, 2023 8:41 PM",restaurant:{id:"4",cover:"assets/restaurants/spiceofindia.png",name:"Spice of India",cuisines:["Indian","Chinese"],rating:4.8,delivery_time:30,distance:3.2,price:120,latitude:28.652982,longitude:77.193031,address:"Pusa Road, New Delhi, India"},payment_id:"",rider:new m("abc@gmail.com","9101000003","Ravi S","4","rider","active",null,"DL05DL4321",28.648626,77.199239,"active"),rider_id:"4"},{address:{id:"1",user_id:"1",address:"Rajiv Chowk, Delhi, India",house:"1st Floor",landmark:"Connaught Place",lat:28.6318545,lng:77.2203533,title:"Home"},restaurant_id:"1",user:{email:"nykz786@gmail.com",phone:"9101000000",name:"Nikhil Agarwal",id:"1",type:"user",status:"active"},order:[{category_id:"1",cover:"assets/dishes/nan.jpg",desc:"Soft and buttery Naan served with delectable paneer curry.",id:"4",name:"Butter Naan with Paneer",price:200,rating:0,status:!0,restaurant_id:"1",variation:!1,veg:!0,quantity:1},{category_id:"2",cover:"assets/dishes/pasta.jpg",desc:"Indulge in the rich and creamy Creamy Alfredo Pasta, a classic Italian favorite.",id:"5",name:"Creamy Alfredo Pasta",price:250,rating:0,status:!0,restaurant_id:"1",variation:!1,veg:!1,quantity:1}],total:450,grandTotal:470,deliveryCharge:20,status:"Cancelled",payment_status:!0,payment_mode:"COD",discount:0,id:"1",user_id:"1",instruction:"",created_at:"Jul 27, 2023 8:09 PM",updated_at:"Jul 27, 2023 8:09 PM",restaurant:{id:"1",cover:"assets/restaurants/1.jpg",name:"Stayfit Kitchen",cuisines:["Indian","Italian","Mexican"],rating:5,delivery_time:25,distance:2.5,price:100,latitude:28.633255,longitude:77.219487,address:"M-Block, Connaught Place, New Delhi, India"},payment_id:""},{address:{id:"2",user_id:"1",address:"Rajiv Chowk, Delhi, India",house:"1st Floor",landmark:"Connaught Place",lat:28.6318545,lng:77.2203533,title:"Home"},restaurant_id:"1",user:{email:"nykz786@gmail.com",phone:"9101000000",name:"Nikhil Agarwal",id:"1",type:"user",status:"active"},order:[{category_id:"1",cover:"assets/dishes/nan.jpg",desc:"Soft and buttery Naan served with delectable paneer curry.",id:"4",name:"Butter Naan with Paneer",price:200,rating:0,status:!0,restaurant_id:"1",variation:!1,veg:!0,quantity:2}],total:400,grandTotal:420,deliveryCharge:20,status:"Created",payment_status:!0,payment_mode:"COD",discount:0,id:"5",user_id:"1",instruction:"",created_at:"Jul 27, 2023 8:41 PM",updated_at:"Jul 27, 2023 8:41 PM",restaurant:{id:"1",cover:"assets/restaurants/1.jpg",name:"Stayfit Kitchen",cuisines:["Indian","Italian","Mexican"],rating:5,delivery_time:25,distance:2.5,price:100,latitude:28.633255,longitude:77.219487,address:"M-Block, Connaught Place, New Delhi, India",user_id:"6",city_id:"1"},payment_id:""},{address:{id:"1",user_id:"1",address:"Rajiv Chowk, Delhi, India",house:"1st Floor",landmark:"Connaught Place",lat:28.6318545,lng:77.2203533,title:"Home"},restaurant_id:"1",user:{email:"nykz786@gmail.com",phone:"9101000000",name:"Nikhil Agarwal",id:"1",type:"user",status:"active"},order:[{category_id:"1",cover:"assets/dishes/nan.jpg",desc:"Soft and buttery Naan served with delectable paneer curry.",id:"4",name:"Butter Naan with Paneer",price:200,rating:0,status:!0,restaurant_id:"1",variation:!1,veg:!0,quantity:1},{category_id:"2",cover:"assets/dishes/pasta.jpg",desc:"Indulge in the rich and creamy Creamy Alfredo Pasta, a classic Italian favorite.",id:"5",name:"Creamy Alfredo Pasta",price:250,rating:0,status:!0,restaurant_id:"1",variation:!1,veg:!1,quantity:1}],total:450,grandTotal:470,deliveryCharge:20,status:"Ongoing",payment_status:!0,payment_mode:"COD",discount:0,id:"6",user_id:"1",instruction:"Less spicy",created_at:"Jul 28, 2023 2:50 PM",updated_at:"Jul 28, 2023 2:50 PM",restaurant:{id:"1",cover:"assets/restaurants/1.jpg",name:"Stayfit Kitchen",cuisines:["Indian","Italian","Mexican"],rating:5,delivery_time:25,distance:2.5,price:100,latitude:28.633255,longitude:77.219487,address:"M-Block, Connaught Place, New Delhi, India",user_id:"6",city_id:"1"},payment_id:"",rider:new m("abc@gmail.com","9101000003","Ravi S","4","rider","active",null,"DL05DL4321",28.5500969,77.1580178,"active"),rider_id:"4"}];var I=[{id:"1",restaurant_id:"1",totalOrders:1,todayOrders:0,totalEarned:405,todayEarned:0,amountReceived:405,amountRemaining:0}];var R={amount_per_km:5,base_amount:20,base_distance:3,radius:15,restaurant_share:90,rider_share:70,tax:18};var $=(()=>{let c=class c{get newOrders(){return this._newOrders.asObservable()}get ongoingOrders(){return this._ongoingOrders.asObservable()}get orders(){return this._orders.asObservable()}get orderReviews(){return this._orderReviews.asObservable()}constructor(){this.currency=O.CURRENCY,this._newOrders=new g([]),this._ongoingOrders=new g([]),this._orders=new g([]),this._orderReviews=new g([]),this.currentOrder=w(null),this.api=h(D),this.global=h(C),this.profileService=h(k),this.auth=h(b)}getUid(){return d(this,null,function*(){this.uid||(this.uid=yield this.auth.getId())})}getRestaurantId(){return d(this,null,function*(){try{let e=yield this.profileService.getProfile();return e==null?void 0:e.id}catch(e){throw e}})}getNewOrders(){return d(this,null,function*(){try{yield this.api.delayedResponse(500),yield this.getUid();let e=yield this.getRestaurantId(),a=o.filter(i=>i.restaurant_id==e&&i.status=="Created"),t=this._newOrders.value||[];return console.log("currentOrders",t),t=t.concat(a),this._newOrders.next(t),a}catch(e){throw e}})}getOngoingOrders(){return d(this,null,function*(){try{yield this.api.delayedResponse(500),yield this.getUid();let e=yield this.getRestaurantId(),a=o.filter(r=>r.restaurant_id==e&&(r.status=="Picked"||r.status=="Accepted"||r.status=="Ongoing")),t=this._ongoingOrders.value||[];console.log("ongoingOrders",t);let i=Array.from(new Set([...t,...a].map(r=>r.id))).map(r=>[...t,...a].find(s=>s.id===r)).filter(r=>r!==void 0);return this._ongoingOrders.next(i),a}catch(e){throw e}})}getPastOrders(e){return d(this,null,function*(){try{let a=yield this.getRestaurantId(),t=new Date;t.setHours(0,0,0,0);let i=o.filter(s=>{if(s.restaurant_id==a&&(s.status=="Delivered"||s.status=="Cancelled"||s.status=="Rejected"))if(e=="pending"){if((s==null?void 0:s.restaurant_payout_status)==!1)return!0}else if(e=="today"){let n=new Date(s.created_at);if(n.setHours(0,0,0,0),n.getTime()===t.getTime())return!0}else return!0;return!1});console.log("orders",i);let r=this._orders.value||[];return console.log("currentOrders",r),r=r.concat(i),this._orders.next(r),i}catch(a){throw a}})}getOrder(e){return d(this,null,function*(){var a;try{if(yield this.api.delayedResponse(500),yield this.getUid(),((a=this.currentOrder())==null?void 0:a.id)==e)return this.currentOrder();let t=o.find(i=>i.id==e);return this.currentOrder.set(t),t}catch(t){throw t}})}changeOrderStatus(e){return d(this,null,function*(){try{yield this.api.delayedResponse(500),yield this.getUid();let a={status:e.status};e!=null&&e.cancel_reason&&(a=v(l({},a),{cancel_reason:e.cancel_reason}));let t=yield this.profileService.getProfile();if(e.status=="Accepted"){console.log("profile: ",t==null?void 0:t.latitude);let s=yield this.getNearbyRiders(t==null?void 0:t.latitude,t==null?void 0:t.longitude);console.log("riders: ",s),(s==null?void 0:s.length)>0?(a=v(l({},a),{rider_requests:s}),this.global.successToast("Driver request sent")):this.global.errorToast("No Drivers near you at the moment, try after sometime");let n=this._newOrders.value;n=n.filter(_=>_.id!=(e==null?void 0:e.id)),this._newOrders.next(n);let u=this._ongoingOrders.value;u=u.concat([l(l({},e),a)]),this._ongoingOrders.next(u)}let i,r;switch(e.status){case"Accepted":r="Order accepted",i=`${t==null?void 0:t.name} is preparing your food.`;break;case"Cancelled":r=`Order cancelled by ${t==null?void 0:t.name}`,i="The food items are currently unavailable.";break;case"Rejected":r=`Order rejected by ${t==null?void 0:t.name}`,i="The food items are currently unavailable.";break;case"Picked":r="Order picked",i="The order is picked and on it's way to your doorstep.";break;default:r=null,i=null;break}if((e==null?void 0:e.status)=="Rejected"||(e==null?void 0:e.status)=="Delivered"||(e==null?void 0:e.status)=="Cancelled"){let s=[];s.push(e),s=s.concat(this._orders.value),this._orders.next(s);let n=this._ongoingOrders.value;n=n.filter(u=>u.id!=(e==null?void 0:e.id)),this._ongoingOrders.next(n)}return this.currentOrder.set(l(l({},e),a)),e}catch(a){throw console.log(a),a}})}updateCustomerWallet(e){return d(this,null,function*(){try{let a={wallet:e==null?void 0:e.grandTotal,updated_at:new Date};return e}catch(a){throw console.log(a),a}})}getNearbyRiders(e,a){return d(this,null,function*(){var t;try{let i=(t=R)==null?void 0:t.radius,r=P.filter(s=>(s==null?void 0:s.type)==="rider").map(s=>{let n=this.getDistanceFromLatLngInKm(e,a,s==null?void 0:s.latitude,s==null?void 0:s.longitude,i);return n<=i?{id:s==null?void 0:s.id,distance:n}:null}).filter(s=>s!==null).sort((s,n)=>s.distance-n.distance).map(s=>s==null?void 0:s.id);return console.log("riders list: ",r),r}catch(i){throw i}})}deg2rad(e){return e*(Math.PI/180)}getDistanceFromLatLngInKm(e,a,t,i,r){let s=6371,n=this.deg2rad(t-e),u=this.deg2rad(i-a),_=Math.sin(n/2)*Math.sin(n/2)+Math.cos(this.deg2rad(e))*Math.cos(this.deg2rad(t))*Math.sin(u/2)*Math.sin(u/2);var M=2*Math.atan2(Math.sqrt(_),Math.sqrt(1-_)),p=s*M;return console.log(p),p<=r?p:null}requestRider(e){return d(this,null,function*(){try{if(e.status=="Accepted"){let a=yield this.profileService.getProfile(),t=yield this.getNearbyRiders(a==null?void 0:a.latitude,a==null?void 0:a.longitude);if((t==null?void 0:t.length)==0){this.global.errorToast("No Drivers near you at the moment, try after sometime");return}let i={rider_requests:t};this.global.successToast("Driver request sent")}else if((e==null?void 0:e.status)=="Rejected"||(e==null?void 0:e.status)=="Delivered"||(e==null?void 0:e.status)=="Cancelled"){let a=[e];a=a.concat(this._orders.value),this._orders.next(a);let t=this._ongoingOrders.value;t=t.filter(i=>i.id!=(e==null?void 0:e.id)),this._ongoingOrders.next(t)}}catch(a){throw console.log(a),a}})}getReviews(e){return d(this,null,function*(){try{let a=yield this.getRestaurantId(),t=o.filter(i=>(i==null?void 0:i.restaurant_id)==a&&(i==null?void 0:i.status)=="Delivered"&&(i==null?void 0:i.rating));return e&&(t=t.slice(0,e),this._orderReviews.next(t)),t}catch(a){throw a}})}getOrderCounts(){return d(this,null,function*(){try{let e=yield this.getRestaurantId();return I.find(t=>t.restaurant_id==e)}catch(e){throw e}})}reset(){this._orders.next(null),this.uid=null}resetNewOrders(){this._newOrders.next(null)}resetOngoingOrders(){this._ongoingOrders.next(null)}resetDashboard(){this.resetNewOrders(),this.resetOngoingOrders(),this.uid=null}resetCurrentOrder(e=null){this.currentOrder.set(e)}};c.\u0275fac=function(a){return new(a||c)},c.\u0275prov=f({token:c,factory:c.\u0275fac,providedIn:"root"});let y=c;return y})();export{$ as a};
